import os
import subprocess
from pwn import *


class ExploitFramework:
    def __init__(self, binary_path, source_path):
        self.binary_path = binary_path
        self.source_path = source_path
        self.static_analysis = {}
        self.read_file()

    def read_file(self):
        if not os.path.isfile(self.source_path):
            print(f"Error: {self.source_path} does not exist or is not a valid file.")
            self.source_code = None
        try:
            with open(self.source_path, "r") as file:
                self.source_code = file.read()
        except Exception as e:
            print(f"Error reading file {file}: {e}")
            self.source_code = None

    def run_command(self, command):
        try:
            result = subprocess.check_output(command, shell=True, text=True, stderr=subprocess.STDOUT)
            return result.strip()
        except subprocess.CalledProcessError as e:
            print(e)
            return None

    def perform_static_analysis(self):
        self.static_analysis["fileMeta"] = self.run_command(f"file {self.binary_path}")
        self.static_analysis["checksec"] = self.run_command(f"checksec {self.binary_path}")

    

