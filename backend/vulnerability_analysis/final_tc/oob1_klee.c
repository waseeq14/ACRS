#include <stdlib.h>
#include <string.h>
#include <klee/klee.h>

typedef struct Employee {
    int id;
    char* name;
    struct Employee* next;
} Employee;

Employee* create_employee(Employee* head, int id) {
    char buffer[100];
    klee_make_symbolic(buffer, sizeof(buffer), "buffer");

    Employee* new_employee = (Employee*)malloc(sizeof(Employee));
    if (new_employee == NULL) {
        return head;
    }

    new_employee->id = id;
    new_employee->name = (char*)malloc(10);
    if (new_employee->name == NULL) {
        free(new_employee);
        return head;
    }
    strncpy(new_employee->name, buffer, 10);
    new_employee->name[9] = '\0';
    new_employee->next = head;

    return new_employee;
}

void update_employee(Employee* head, int id) {
    Employee* current = head;
    while (current != NULL && current->id != id) {
        current = current->next;
    }

    if (current == NULL) {
        return;
    }

    char buffer[100];
    klee_make_symbolic(buffer, sizeof(buffer), "buffer");

    for (int i = 0; i < strlen(buffer); i++) {
        current->name[i] = buffer[i];
    }
    current->name[strlen(buffer)] = '\0';
}

int count_employees(Employee* head) {
    int count = 0;
    Employee* current = head;
    while (current != NULL) {
        count++;
        current = current->next;
    }
    klee_print_expr("Total employees:", count);
    return count;
}

void print_employees(Employee* head) {
    Employee* current = head;
    while (current != NULL) {
        klee_print_expr("ID:", current->id);
        klee_print_expr("Name:", current->name[0]);
        current = current->next;
    }
}

void free_list(Employee* head) {
    Employee* current = head;
    while (current != NULL) {
        Employee* temp = current;
        current = current->next;
        free(temp->name);
        free(temp);
    }
}

int main() {
    Employee* head = NULL;

    head = create_employee(head, 1);
    head = create_employee(head, 2);
    update_employee(head, 1);
    count_employees(head);
    print_employees(head);
    free_list(head);

    return 0;
}